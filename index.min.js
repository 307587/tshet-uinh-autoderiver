!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Autoderiver={})}(this,(function(e){"use strict";function t(e){const t=document.createElement("pre");return t.innerText=e,t.innerHTML}function n(e){Swal.fire({animation:!1,text:e,confirmButtonText:"確定"})}function o(e){let n=`<p lang="en">Error: ${t(e.message)}</p>`;e.stack&&(n+=`<pre lang="en-x-code" style="text-align: left;">${t(e.stack)}</pre>`),Swal.fire({animation:!1,icon:"error",html:n,confirmButtonText:"確定"})}const c="已成功匯出至剪貼簿",d="瀏覽器不支援匯出至剪貼簿，操作失敗";"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function a(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var r=a(function(e){var t={exports:{}};return e(t,t.exports),t.exports}((function(e,t){!function(e){function t(){return Math.max(document.body.scrollWidth,document.documentElement.scrollWidth,document.body.offsetWidth,document.documentElement.offsetWidth,document.documentElement.clientWidth)}function n(){const e=document.createElement("div");e.classList.add("large-tooltip-outer");const n=document.createElement("div");return n.classList.add("large-tooltip-inner"),e.appendChild(n),n.classList.add("large-tooltip-hidden"),document.body.appendChild(e),{addTooltip:(e,o)=>{o.addEventListener("mouseenter",(()=>{const c=o.getBoundingClientRect(),d=c.top+window.pageYOffset,a=c.left+window.pageXOffset;n.innerHTML="",n.appendChild(e);const r=n.getBoundingClientRect(),i=r.height,l=r.width,s=d-i;let u=a-l/2;const p=parseFloat(getComputedStyle(document.body).fontSize);u=u<p?p:u;const m=t()-p-l;u=u>m?m:u,n.style.top=s+"px",n.style.left=u+"px",n.classList.remove("large-tooltip-hidden")}),!1),o.addEventListener("mouseleave",(()=>{n.classList.add("large-tooltip-hidden")}),!1)}}}e.init=n,Object.defineProperty(e,"__esModule",{value:!0})}(t)})));function i(e){fetch(`https://cdn.jsdelivr.net/gh/nk2028/qieyun-examples@ef431c2/${e}.js`).then((e=>e.text())).then((e=>s.setValue(e))).catch((e=>o(e)))}let l,s,u,p;function callDeriver(e,n){try{const t=u(e,n);if(null==t)throw new Error("Result is null");return t}catch(n){throw function(e,n){let o=`<p>${e}, Error: ${t(n.message)}</p>`;n.stack&&(o+=`<pre lang="en-x-code" style="text-align: left;">${t(n.stack)}</pre>`),Swal.fire({animation:!1,icon:"error",html:o,confirmButtonText:"確定"})}(`音韻地位：${e.描述}`,n),n}}function m(e,t){const n=document.createElement("p");n.classList.add("tooltip-item");const o=document.createElement("span");o.lang="och-Latn-fonipa",o.innerText=e,n.appendChild(o),n.appendChild(document.createTextNode(" "));for(const[e,{"字頭":o,"解釋":c,"音韻地位":d}]of t.entries()){0!==e&&n.appendChild(document.createTextNode("\n"));let t=d.反切(o);t=null==t?"":`${t}切 `;const a=document.createElement("span");a.classList.add("tooltip-ch"),a.innerText=o,n.appendChild(a),n.appendChild(document.createTextNode(" ")),n.appendChild(document.createTextNode(`${d.描述} ${t}${c}`))}return n}function h(e,t){let n;t?(n=Yitizi.get(e),n.unshift(e)):n=[e];const o=new Map;for(const e of n)for(const{"音韻地位":t,"解釋":n}of Qieyun.query字頭(e)){const c=callDeriver(t,e);null==o.get(c)&&o.set(c,[]),o.get(c).push({"字頭":e,"解釋":n,"音韻地位":t})}switch(o.size){case 0:return function(e){return document.createTextNode(e)}(e);case 1:return function(e,t){const[n,o]=[...t][0],c=document.createElement("span");c.classList.add("ruby-wrapper");const d=document.createElement("ruby");d.appendChild(document.createTextNode(e));const a=document.createElement("div");a.classList.add("tooltip-items-wrapper");const r=document.createElement("rp");r.appendChild(document.createTextNode("(")),d.appendChild(r);const i=document.createElement("rt");i.lang="och-Latn-fonipa",i.innerText=n,d.appendChild(i);const s=document.createElement("rp");s.appendChild(document.createTextNode(")")),d.appendChild(s);const u=m(n,o);return a.appendChild(u),c.appendChild(d),l.addTooltip(a,c),c}(e,o);default:return function(e,t){const n=document.createElement("span");n.classList.add("ruby-wrapper");const o=document.createElement("ruby");o.classList.add("entry-multiple"),o.classList.add("entry-unresolved"),o.appendChild(document.createTextNode(e));const c=document.createElement("div");c.classList.add("tooltip-items-wrapper");const d=document.createElement("rp");d.appendChild(document.createTextNode("(")),o.appendChild(d);const a=document.createElement("rt");a.lang="och-Latn-fonipa",o.appendChild(a);const r=document.createElement("rp");r.appendChild(document.createTextNode(")")),o.appendChild(r);const i=[];for(const[e,[n,d]]of[...t].entries()){const t=m(n,d);t.addEventListener("click",(()=>{a.innerText=n,o.classList.remove("entry-unresolved"),i.map((e=>e.classList.remove("selected"))),t.classList.add("selected")})),c.appendChild(t),i.push(t),0===e&&(a.innerText=n,t.classList.add("selected"))}return n.appendChild(o),l.addTooltip(c,n),n}(e,o)}}function f(){fetch("https://cdn.jsdelivr.net/gh/nk2028/qieyun-text-label@1150f08/index.html").then((e=>e.text())).then((e=>function(e){const t=document.getElementById("outputArea");t.innerHTML="";const{body:n}=(new DOMParser).parseFromString(e,"text/html");n.querySelectorAll("ruby").forEach((e=>{const t=e.querySelector("rt"),n=e.childNodes[0].textContent,o=t.innerText,c=callDeriver(Qieyun.音韻地位.from描述(o),n);t.lang="och-Latn-fonipa",t.innerText=c})),n.querySelectorAll("h1").forEach((e=>{const t=document.createElement("h3");t.innerHTML=e.innerHTML,e.parentNode.replaceChild(t,e)})),n.querySelectorAll("rt").forEach((e=>{const{parentNode:t}=e,n=document.createElement("rp");n.innerText="(",t.insertBefore(n,e);const o=document.createElement("rp");o.innerText=")",t.appendChild(o)})),[...n.childNodes].slice(1).forEach((e=>{n.insertBefore(document.createTextNode("\n"),e)}));const o=document.createDocumentFragment();n.childNodes.forEach((e=>{o.appendChild(e)})),t.appendChild(o)}(e))).catch((e=>o(e)))}document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("schemaInput");s=CodeMirror(e,{mode:"javascript",lineNumbers:!0})}),!1),document.addEventListener("DOMContentLoaded",(()=>{l=r.init()}),!1),document.addEventListener("DOMContentLoaded",(()=>{i(document.getElementById("schemaSelect").schema.value)})),document.addEventListener("DOMContentLoaded",(()=>{p=new tingle.modal({closeLabel:""}),p.setContent(document.getElementById("templateAbout").innerHTML)}),!1),document.addEventListener("DOMContentLoaded",(()=>{null!=document.cookie.split("; ").find((e=>e.startsWith("variantCharSwitch")))&&(document.getElementById("convertVariantCharSwitch").checked=!0)}),!1),e.handleCopy=function(){const e=document.getElementById("outputArea").textContent;e?function(e){if(null==navigator.clipboard){const t=document.createElement("textarea");t.value=e,t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select();try{n(document.execCommand("copy")?c:d)}catch(e){n(d)}document.body.removeChild(t)}else navigator.clipboard.writeText(e).then((()=>n(c)),(()=>n(d)))}(e):function(e){const n=`<p lang="en-x-code">Error: ${t(e.message)}</p>`;Swal.fire({animation:!1,icon:"error",html:n,confirmButtonText:"確定"})}(new Error("請先進行操作，再匯出結果"))},e.handleLoadSchema=i,e.handlePredefinedOptions=function(){!function(){try{u=new Function("音韻地位","字頭",s.getValue())}catch(e){throw o(e),e}}();const e=document.getElementById("convertVariantCharSwitch").checked;switch(document.getElementById("predefinedOptions").value){case"convertArticle":!function(e){const t=document.getElementById("outputArea"),n=document.getElementById("articleInput");t.innerHTML="";const o=document.createDocumentFragment();for(const t of n.value)o.appendChild(h(t,e));t.appendChild(o)}(e);break;case"convertPresetArticle":f();break;case"exportAllSmallRhymes":!function(){const e=document.getElementById("outputArea");e.innerHTML="";const t=document.createDocumentFragment();for(const e of Qieyun.iter音韻地位()){const{"描述":n,"代表字":o}=e;t.appendChild(document.createTextNode(`${n} `));const c=document.createElement("span");c.lang="och-Latn-fonipa",c.appendChild(document.createTextNode(callDeriver(e,null))),t.appendChild(c),t.appendChild(document.createTextNode(` ${o}\n`))}e.appendChild(t)}();break;case"exportAllSyllables":!function(){const e=document.getElementById("outputArea");e.innerHTML="";const t=document.createElement("span");t.lang="och-Latn-fonipa";const n=new Set;for(const e of Qieyun.iter音韻地位()){const t=callDeriver(e,null);n.add(t)}t.innerText=[...n].join(", "),e.appendChild(t)}();break;case"exportAllSyllablesWithCount":!function(){const e=document.getElementById("outputArea");e.innerHTML="";const t=document.createElement("span");t.lang="och-Latn-fonipa";const n=new Map;for(const e of Qieyun.iter音韻地位()){const t=callDeriver(e,null),o=n.get(t);n.set(t,null==o?1:o+1)}const o=[...n];o.sort(((e,t)=>t[1]-e[1])),t.innerText=o.map((([e,t])=>`${e} (${t})`)).join(", "),e.appendChild(t)}()}document.getElementById("outputArea").scrollIntoView({behavior:"smooth",block:"nearest"})},e.setOrRemoveCookie=function(e,t){document.cookie=!0===t?`${e}=true; expires=Tue, 19 Jan 2038 03:14:07 GMT; secure; samesite=strict`:`${e}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; secure; samesite=strict`},e.showAbout=function(){p.open()},Object.defineProperty(e,"__esModule",{value:!0})}));
